# A3! 有償石抱え落ち防止スクリプト

## 概要

Android(Google Play Store)の有償アイテム180日期限とうまく付き合いつつ有償石を手に入れるためのGoogle Apps Scriptです。Google SpreadSheetと併用します。

## 対象ユーザー

- AndroidでA3!をプレイしている
- 無償石をそれなりに持っている
- 普段あまり石を使わない
- マンスリーパスや誕生日称号などを購入したいが、有償石を使いきれるか分からない
- PCで作業ができる
  - スマホのGoogle SpreadSheetアプリは不可
  - タブレットは未検証

## 使い方

1. 新しい[Google SpreadSheet](https://docs.google.com/spreadsheets/create?hl=JA)を1枚用意する
    - ファイル名は自由
    - 保存場所も自由
1. ファイルの中にタブを2つ用意する
    - 「一覧」タブ：何も記入しない(スクリプトを実行すると内容が全部削除されるので、消されたくない内容は*書かない*)
    - 「記録」タブ：1行目に「日付・種類・個数」とヘッダを用意する
1. 「記録」タブの2行目以降にデータを記入する
    - 日付：購入した/使用した日
    - 種類：購入した場合は「増えた」、使用した場合は「減った」
    - 個数：購入した/使用した数
1. スプレッドシートのメニューにある 拡張機能 > Apps Script をクリックする
1. プロジェクト名を適当に記入する(この例では「記帳」とする)
1. 「コード.gs」の中に、script.jsの内容をすべてコピーして貼り付ける
1. 17行目のメールアドレス(sample＠example.com)を自分のものに変更する
    - 自分のメールアドレスが外部に漏れることはない
    - メールアドレスは半角のシングルクォート `'` で挟む
1. 「実行」ボタンをクリックする
    1. 「承認が必要です」ダイアログは「権限を確認」をクリックする
    1. 「アカウントの選択」は自分のGoogleアカウントを選択する
    1. 「このアプリはGoogleで確認されていません」は、左下の「詳細」をクリックする
    1. 「記帳(安全ではないページ)に移動」をクリックする
    1. 「記帳がGoogleアカウントへのアクセスをリクエストしています」は「許可」をクリックする
    1. スプレッドシートの読み書きとメール送信の2種類を使うので、承認手順は2周する必要があるかもしれない
1. 実行が終了すると「一覧」タブに結果が表示されているはず

### 「記録」タブの記入例

|  日付  |  種類  | 個数 |
| ---- | ---- | ---- |
| 2023/01/27 | 増えた | 175 |
| 2023/01/29 | 減った | 145 |
| 2023/05/01 | 増えた | 25 |

### 「一覧」タブの出力例

スクリプトを実行すると、現時点で持っている有償石の購入日・個数・使用期限・有償ガチャ開始日が一覧表示される。

| 購入日 | 個数 | 使用期限 | 有償ガチャ開始日 |
| ---- | ---- | ---- | ---- |
| 2023/01/27 | 30 | 2023/07/26 | 2023/07/19 |
| 2023/05/01 | 25 | 2023/10/28 | 2023/10/22 |

有償ガチャ開始日から1日1回プレミアムスカウト(有償石5個)を回すと、良い感じに使い切れる。

また、スクリプトを実行した日が有償ガチャ開始日～使用期限の間にある場合は、リマインドメールが送られてくる。

## 定期実行

毎日1回自動で実行するように設定すると、記録さえしっかりしていればリマインドメールも自動で届く。

1. Apps Script編集画面を開く
1. 左側の柱から「トリガー」(目覚まし時計のアイコン)をクリックする
1. 「トリガーを追加」をクリックする
1. 「記帳 のトリガーを追加」画面は以下のように設定する
    - 実行する関数を選択：main
    - 実行するデプロイを選択：Head
    - イベントのソースを選択：時間主導型
    - 時間ベースのトリガーのタイプを選択：日付ベースのタイマー
    - 時刻を選択：午前0時～1時
    - エラー通知設定：毎日通知を受け取る
1. 画面右下の「保存」をクリックする

これで、毎日0時～1時の間にスクリプトが1回実行される。時間を変えたい場合は「時刻を選択」で好きなものを選ぶ。ただし「きっかり0時」といった指定はできないので注意。0時～1時にしておくと、毎日0時半くらいに実行されている気がする。

